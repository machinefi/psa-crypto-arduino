<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PSA Crypto: src/include/tinycrypt/cmac_mode.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PSA Crypto
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_b0856f6b0d80ccb263b2f415c91f9e17.html">include</a></li><li class="navelem"><a class="el" href="dir_cb82b0834b2d4ad8b46d6782ee28b60e.html">tinycrypt</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">cmac_mode.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Interface to a CMAC implementation.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="tinycrypt_2aes_8h_source.html">aes.h</a>&quot;</code><br />
<code>#include &lt;stddef.h&gt;</code><br />
</div>
<p><a href="cmac__mode_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtc__cmac__struct.html">tc_cmac_struct</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a3bd45495be11bb4f526e287849dc11cf"><td class="memItemLeft" align="right" valign="top"><a id="a3bd45495be11bb4f526e287849dc11cf"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>TC_CMAC_PADDING</b>&#160;&#160;&#160;0x80</td></tr>
<tr class="separator:a3bd45495be11bb4f526e287849dc11cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a551107bbadb818ceac2cfe39a8f14065"><td class="memItemLeft" align="right" valign="top"><a id="a551107bbadb818ceac2cfe39a8f14065"></a>
typedef struct <a class="el" href="structtc__cmac__struct.html">tc_cmac_struct</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>TCCmacState_t</b></td></tr>
<tr class="separator:a551107bbadb818ceac2cfe39a8f14065"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5c7ffd4d8990f9868fb7f78ffe334ffa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cmac__mode_8h.html#a5c7ffd4d8990f9868fb7f78ffe334ffa">tc_cmac_setup</a> (<a class="el" href="structtc__cmac__struct.html">TCCmacState_t</a> s, const uint8_t *key, <a class="el" href="structtc__aes__key__sched__struct.html">TCAesKeySched_t</a> sched)</td></tr>
<tr class="memdesc:a5c7ffd4d8990f9868fb7f78ffe334ffa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configures the CMAC state to use the given AES key.  <a href="cmac__mode_8h.html#a5c7ffd4d8990f9868fb7f78ffe334ffa">More...</a><br /></td></tr>
<tr class="separator:a5c7ffd4d8990f9868fb7f78ffe334ffa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a527ae49656033a1adabd909c211826d7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cmac__mode_8h.html#a527ae49656033a1adabd909c211826d7">tc_cmac_erase</a> (<a class="el" href="structtc__cmac__struct.html">TCCmacState_t</a> s)</td></tr>
<tr class="memdesc:a527ae49656033a1adabd909c211826d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Erases the CMAC state.  <a href="cmac__mode_8h.html#a527ae49656033a1adabd909c211826d7">More...</a><br /></td></tr>
<tr class="separator:a527ae49656033a1adabd909c211826d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4baa6368298c98ffb2b387573c504874"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cmac__mode_8h.html#a4baa6368298c98ffb2b387573c504874">tc_cmac_init</a> (<a class="el" href="structtc__cmac__struct.html">TCCmacState_t</a> s)</td></tr>
<tr class="memdesc:a4baa6368298c98ffb2b387573c504874"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes a new CMAC computation.  <a href="cmac__mode_8h.html#a4baa6368298c98ffb2b387573c504874">More...</a><br /></td></tr>
<tr class="separator:a4baa6368298c98ffb2b387573c504874"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ac297f133e86d7b8ce317354a8efa2d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cmac__mode_8h.html#a9ac297f133e86d7b8ce317354a8efa2d">tc_cmac_update</a> (<a class="el" href="structtc__cmac__struct.html">TCCmacState_t</a> s, const uint8_t *data, size_t dlen)</td></tr>
<tr class="memdesc:a9ac297f133e86d7b8ce317354a8efa2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Incrementally computes CMAC over the next data segment.  <a href="cmac__mode_8h.html#a9ac297f133e86d7b8ce317354a8efa2d">More...</a><br /></td></tr>
<tr class="separator:a9ac297f133e86d7b8ce317354a8efa2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00d47affef4bb938d41c6c543fcefdca"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cmac__mode_8h.html#a00d47affef4bb938d41c6c543fcefdca">tc_cmac_final</a> (uint8_t *tag, <a class="el" href="structtc__cmac__struct.html">TCCmacState_t</a> s)</td></tr>
<tr class="memdesc:a00d47affef4bb938d41c6c543fcefdca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates the tag from the CMAC state.  <a href="cmac__mode_8h.html#a00d47affef4bb938d41c6c543fcefdca">More...</a><br /></td></tr>
<tr class="separator:a00d47affef4bb938d41c6c543fcefdca"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Interface to a CMAC implementation. </p>
<p>Overview: CMAC is defined NIST in SP 800-38B, and is the standard algorithm for computing a MAC using a block cipher. It can compute the MAC for a byte string of any length. It is distinguished from CBC-MAC in the processing of the final message block; CMAC uses a different technique to compute the final message block is full size or only partial, while CBC-MAC uses the same technique for both. This difference permits CMAC to be applied to variable length messages, while all messages authenticated by CBC-MAC must be the same length.</p>
<p>Security: AES128-CMAC mode of operation offers 64 bits of security against collision attacks. Note however that an external attacker cannot generate the tags him/herself without knowing the MAC key. In this sense, to attack the collision property of AES128-CMAC, an external attacker would need the cooperation of the legal user to produce an exponentially high number of tags (e.g. 2^64) to finally be able to look for collisions and benefit from them. As an extra precaution, the current implementation allows to at most 2^48 calls to the tc_cmac_update function before re-calling tc_cmac_setup (allowing a new key to be set), as suggested in Appendix B of SP 800-38B.</p>
<p>Requires: AES-128</p>
<p>Usage: This implementation provides a "scatter-gather" interface, so that the CMAC value can be computed incrementally over a message scattered in different segments throughout memory. Experience shows this style of interface tends to minimize the burden of programming correctly. Like all symmetric key operations, it is session oriented.</p>
<p>To begin a CMAC session, use tc_cmac_setup to initialize a struct <a class="el" href="structtc__cmac__struct.html">tc_cmac_struct</a> with encryption key and buffer. Our implementation always assume that the AES key to be the same size as the block cipher block size. Once setup, this data structure can be used for many CMAC computations.</p>
<p>Once the state has been setup with a key, computing the CMAC of some data requires three steps:</p>
<p>(1) first use tc_cmac_init to initialize a new CMAC computation. (2) next mix all of the data into the CMAC computation state using tc_cmac_update. If all of the data resides in a single data segment then only one tc_cmac_update call is needed; if data is scattered throughout memory in n data segments, then n calls will be needed. CMAC IS ORDER SENSITIVE, to be able to detect attacks that swap bytes, so the order in which data is mixed into the state is critical! (3) Once all of the data for a message has been mixed, use tc_cmac_final to compute the CMAC tag value.</p>
<p>Steps (1)-(3) can be repeated as many times as you want to CMAC multiple messages. A practical limit is 2^48 1K messages before you have to change the key.</p>
<p>Once you are done computing CMAC with a key, it is a good idea to destroy the state so an attacker cannot recover the key; use tc_cmac_erase to accomplish this. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a527ae49656033a1adabd909c211826d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a527ae49656033a1adabd909c211826d7">&#9670;&nbsp;</a></span>tc_cmac_erase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tc_cmac_erase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtc__cmac__struct.html">TCCmacState_t</a>&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Erases the CMAC state. </p>
<dl class="section return"><dt>Returns</dt><dd>returns TC_CRYPTO_SUCCESS (1) after having configured the CMAC state returns TC_CRYPTO_FAIL (0) if: s == NULL</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>IN/OUT &ndash; the state to erase </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a00d47affef4bb938d41c6c543fcefdca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00d47affef4bb938d41c6c543fcefdca">&#9670;&nbsp;</a></span>tc_cmac_final()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tc_cmac_final </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>tag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structtc__cmac__struct.html">TCCmacState_t</a>&#160;</td>
          <td class="paramname"><em>s</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generates the tag from the CMAC state. </p>
<dl class="section return"><dt>Returns</dt><dd>returns TC_CRYPTO_SUCCESS (1) after successfully generating the tag returns TC_CRYPTO_FAIL (0) if: tag == NULL or s == NULL</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tag</td><td>OUT &ndash; the CMAC tag </td></tr>
    <tr><td class="paramname">s</td><td>IN &ndash; CMAC state </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4baa6368298c98ffb2b387573c504874"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4baa6368298c98ffb2b387573c504874">&#9670;&nbsp;</a></span>tc_cmac_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tc_cmac_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtc__cmac__struct.html">TCCmacState_t</a>&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes a new CMAC computation. </p>
<dl class="section return"><dt>Returns</dt><dd>returns TC_CRYPTO_SUCCESS (1) after having initialized the CMAC state returns TC_CRYPTO_FAIL (0) if: s == NULL</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>IN/OUT &ndash; the state to initialize </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5c7ffd4d8990f9868fb7f78ffe334ffa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c7ffd4d8990f9868fb7f78ffe334ffa">&#9670;&nbsp;</a></span>tc_cmac_setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tc_cmac_setup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtc__cmac__struct.html">TCCmacState_t</a>&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structtc__aes__key__sched__struct.html">TCAesKeySched_t</a>&#160;</td>
          <td class="paramname"><em>sched</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configures the CMAC state to use the given AES key. </p>
<dl class="section return"><dt>Returns</dt><dd>returns TC_CRYPTO_SUCCESS (1) after having configured the CMAC state returns TC_CRYPTO_FAIL (0) if: s == NULL or key == NULL</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>IN/OUT &ndash; the state to set up </td></tr>
    <tr><td class="paramname">key</td><td>IN &ndash; the key to use </td></tr>
    <tr><td class="paramname">sched</td><td>IN &ndash; AES key schedule </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9ac297f133e86d7b8ce317354a8efa2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ac297f133e86d7b8ce317354a8efa2d">&#9670;&nbsp;</a></span>tc_cmac_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tc_cmac_update </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtc__cmac__struct.html">TCCmacState_t</a>&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>dlen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Incrementally computes CMAC over the next data segment. </p>
<dl class="section return"><dt>Returns</dt><dd>returns TC_CRYPTO_SUCCESS (1) after successfully updating the CMAC state returns TC_CRYPTO_FAIL (0) if: s == NULL or if data == NULL when dlen &gt; 0</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>IN/OUT &ndash; the CMAC state </td></tr>
    <tr><td class="paramname">data</td><td>IN &ndash; the next data segment to MAC </td></tr>
    <tr><td class="paramname">dlen</td><td>IN &ndash; the length of data in bytes </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
